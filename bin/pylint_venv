#!/bin/bash

venv="${1?missing virtualenv location}"
shift
activator="$venv/bin/activate_this.py"
venv_python="$venv/bin/python"

if [[ -d "$venv" ]] && [[ -x "$venv_python" ]] && [[ -f "$activator" ]]; then
    system_python="$(basename $(readlink -f "$venv_python"))"
    hook_code="exec(open('$activator').read(), {'__file__': '$activator'})"
    $system_python -m pylint --init-hook "$hook_code" "$@"
else
    echo "Not a virtualenv: '$venv'"
    exit 1
fi
